name: Debug S3 Structure

on:
  push:
    branches:
      - main

jobs:
  debug:
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
      
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Check local file structure
        run: |
          echo "=== Repository root ==="
          ls -la
          echo ""
          echo "=== Expat Teacher's Lounge Website folder ==="
          ls -la "Expat Teacher's Lounge Website/"
          echo ""
          echo "=== Looking for index.html specifically ==="
          find . -name "index.html" -type f
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: eu-north-1
      
      - name: Check current S3 bucket contents
        run: |
          echo "=== Current S3 bucket structure ==="
          aws s3 ls s3://${{ secrets.AWS_S3_BUCKET }}/ --recursive
          echo ""
          echo "=== Looking for index.html in S3 ==="
          aws s3 ls s3://${{ secrets.AWS_S3_BUCKET }}/index.html || echo "index.html not found at root"
      
      - name: Upload with verbose logging
        run: |
          echo "=== Uploading with detailed logging ==="
          aws s3 sync "Expat Teacher's Lounge Website/" s3://${{ secrets.AWS_S3_BUCKET }}/ --delete --debug
      
      - name: Verify upload
        run: |
          echo "=== Final S3 bucket structure ==="
          aws s3 ls s3://${{ secrets.AWS_S3_BUCKET }}/ --recursive
